generator mongodbClient {
  provider = "prisma-client-js"
  output   = "../../../../node_modules/.prisma/mongodb"
}

datasource mongodb {
  provider = "mongodb"
  url      = env("DATABASE_URL_MONGODB")
}

model Category {
  id            String     @id @default(auto()) @map("_id") @mongodb.ObjectId
  name          String     @unique
  description   String?
  subcategories Category[] @relation("Subcategory")
  parent        Category?  @relation("Subcategory", fields: [parentId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  parentId      String?
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt
  product       Product[]

  @@index([parentId])
}

model Product {
  id                       String                     @id @default(auto()) @map("_id") @mongodb.ObjectId
  productName              String                     @unique
  categoryId               String
  category                 Category                   @relation(fields: [categoryId], references: [id])
  shortDescription         String
  longDescription          String
  sku                      String?                    @unique
  upc                      String?                    @unique
  ean                      String?                    @unique
  isbn                     String?                    @unique
  barcode                  String?                    @unique
  productCover             String
  productMedia             String[]
  price                    Float
  taxes                    TaxDetail[]
  condition                ProductCondition
  weight                   Float
  dimensions               Dimension?
  availableShippingMethods String[]
  shippingRestrictions     String[]
  tags                     String[]
  installmentPayments      InstallmentDetail[]
  acceptedPaymentMethods   String[]
  personalizationOptions   String[]
  sustainability           SustainabilityAttributes[]
  brand                    String?
  manufacturer             String?
  warranty                 WarrantyDetail?
  createdAt                DateTime                   @default(now())
  updatedAt                DateTime                   @updatedAt
  inventoryState           Inventory[]

  @@index([categoryId])
}

model Inventory {
  id                         String    @id @default(auto()) @map("_id") @mongodb.ObjectId
  productId                  String
  product                    Product   @relation(fields: [productId], references: [id])
  warehouseId                String
  productLocation            String?
  qtyAvailable               Int       @default(0)
  qtyReserved                Int       @default(0)
  estimatedReplenishmentDate DateTime?
  lotNumber                  String?
  serialNumbers              String[]
  createdAt                  DateTime  @default(now())
  updatedAt                  DateTime  @updatedAt

  @@index([warehouseId, productId])
  @@index([productId, warehouseId, productLocation])
}

// Types for Products
enum ProductCondition {
  NEW
  USED
  REFURBISHED
}

type TaxDetail {
  type    String
  rate    Float
  country String?
}

type Dimension {
  height Float
  width  Float
  depth  Float
}

type InstallmentDetail {
  months       Int
  interestRate Float
}

type SustainabilityAttributes {
  certification      String
  recycledPercentage Float
}

type WarrantyDetail {
  duration     String
  coverage     String
  instructions String
}
